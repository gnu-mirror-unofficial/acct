<HTML>
<HEAD>
<!-- This HTML file has been created by texi2html 1.52
     from ../texi/accounting.texi on 7 November 1998 -->

<TITLE>Accounting Utilities Manual</TITLE>
</HEAD>
<BODY>
<H1>GNU Accounting Utilities</H1>
<H2>Version 6.3.2</H2>
<H2>10 March 1998</H2>
<ADDRESS>Noel Cragg <CODE>(<A HREF="mailto:noel@gnu.ai.mit.edu">noel@gnu.ai.mit.edu</A>)</CODE></ADDRESS>
<P>
<P><HR><P>
<H1>Table of Contents</H1>
<UL>
<LI><A NAME="TOC1" HREF="accounting.html#SEC1">Preface</A>
<UL>
<LI><A NAME="TOC2" HREF="accounting.html#SEC2">A Note on File Names and Locations</A>
<LI><A NAME="TOC3" HREF="accounting.html#SEC3">History of the Accounting Utilities</A>
</UL>
<LI><A NAME="TOC4" HREF="accounting.html#SEC4"><CODE>ac</CODE></A>
<UL>
<LI><A NAME="TOC5" HREF="accounting.html#SEC5">Flags</A>
<LI><A NAME="TOC6" HREF="accounting.html#SEC6">Problems</A>
<UL>
<UL>
<LI><A NAME="TOC7" HREF="accounting.html#SEC7">The FTP Problem</A>
<LI><A NAME="TOC8" HREF="accounting.html#SEC8">The Shutdown/Reboot Problem</A>
<LI><A NAME="TOC9" HREF="accounting.html#SEC9">Stupid System V Machines</A>
</UL>
</UL>
</UL>
<LI><A NAME="TOC10" HREF="accounting.html#SEC10"><CODE>accton</CODE></A>
<UL>
<LI><A NAME="TOC11" HREF="accounting.html#SEC11">Flags</A>
</UL>
<LI><A NAME="TOC12" HREF="accounting.html#SEC12"><CODE>last</CODE></A>
<UL>
<LI><A NAME="TOC13" HREF="accounting.html#SEC13">Flags</A>
<LI><A NAME="TOC14" HREF="accounting.html#SEC14">Problems</A>
<UL>
<UL>
<LI><A NAME="TOC15" HREF="accounting.html#SEC15">The Clock Change Problem</A>
<LI><A NAME="TOC16" HREF="accounting.html#SEC16">The Ftp Problem</A>
</UL>
</UL>
</UL>
<LI><A NAME="TOC17" HREF="accounting.html#SEC17"><CODE>lastcomm</CODE></A>
<UL>
<LI><A NAME="TOC18" HREF="accounting.html#SEC18">Flags</A>
</UL>
<LI><A NAME="TOC19" HREF="accounting.html#SEC19"><CODE>sa</CODE></A>
<UL>
<LI><A NAME="TOC20" HREF="accounting.html#SEC20">Flags</A>
<LI><A NAME="TOC21" HREF="accounting.html#SEC21">Problems</A>
<UL>
<LI><A NAME="TOC22" HREF="accounting.html#SEC22">mips sa</A>
</UL>
</UL>
</UL>
<P><HR><P>

<P>
Copyright (C) 1993, 1996, 1997 Free Software Foundation,
Inc.

</P>
<P>
Permission is granted to make and distribute verbatim copies of
this manual provided the copyright notice and this permission notice
are preserved on all copies.

</P>
<P>
Permission is granted to copy and distribute modified versions of this
manual under the conditions for verbatim copying, provided that the
entire resulting derived work is distributed under the terms of a
permission notice identical to this one.

</P>
<P>
Permission is granted to copy and distribute translations of this manual
into another language, under the above conditions for modified versions,
except that this permission notice may be stated in a translation
approved by the Foundation.

</P>



<H1><A NAME="SEC1" HREF="accounting.html#TOC1">Preface</A></H1>

<P>
Way back a long time ago, Thompson and Ritchie were sitting opposite one
another at the commissary, sipping coffees and discussing their evolving
behemoth.

</P>
<P>
"This behemoth of ours," said Ken, "is becoming rather popular,
wouldn't you say?"  "Yes," said Dennis.  "Every time I want to do a
compilation, I have to wait for hours and hours.  It's infuriating."
They both agreed that the load on their system was too great.  Both
sighed, picked up their mugs, and went back to the workbench.  Little
did they know that an upper-management type was sitting just within
earshot of their conversation.

</P>
<P>
"We are AT&#38;T Bell Laboratories, aren't we?" the upper-management type
thought to himself.  "Well, what is our organization best known for?"
The brill-cream in his hair glistened.  "Screwing people out of lots of
money, of course!  If there were some way that we could keep tabs on
users and charge them through the nose for their CPU time..."

</P>
<P>
The accounting utilities were born.

</P>
<P>
Seriously though, the accouting utilities can provide a system
administrator with useful information about system usage--connections,
programs executed, and utilization of system resources.

</P>
<P>
Information about users--their connect time, location, programs
executed, and the like--is automatically recored in files by
<CODE>init</CODE> and <CODE>login</CODE>.  Four of them are of interest to us:
<CODE>wtmp</CODE>, which has records for each login and logout;
<CODE>acct</CODE>, which records each command that was run;
<CODE>usracct</CODE> and <CODE>savacct</CODE>, which contain
summaries of the information in <CODE>acct</CODE> by user and
command, respectively.  Each of the accounting utilities reports or
summarizes information stored in these files.

</P>
<DL COMPACT>

<DT><CODE>ac</CODE>
<DD>
prints statistics about users' connect time.  <CODE>ac</CODE> can tell you how
long a particular user or group of users were connected to your system,
printing totals by day or for all of the entries in the
<CODE>wtmp</CODE> file.

<DT><CODE>accton</CODE>
<DD>
turns accounting on or off.

<DT><CODE>last</CODE>
<DD>
lists the logins on the system, most recent first.  With <CODE>last</CODE>,
you can search the <CODE>wtmp</CODE> file for a particular user or
terminal name (to which the user was connected).  Of special interest
are two fake users, <SAMP>`reboot'</SAMP> and <SAMP>`shutdown'</SAMP>, which are
recorded when the system is shut down or reboots.

<DT><CODE>lastcomm</CODE>
<DD>
lists the commands executed on the system, most recent first, showing
the run state of each command.  With <CODE>last</CODE>, you can search the
<CODE>acct</CODE> file for a particular user, terminal, or command.

<DT><CODE>sa</CODE>
<DD>
summarizes the information in the <CODE>acct</CODE> file into the
<CODE>savacct</CODE> and <CODE>usracct</CODE> file.  It also
generates reports about commands, giving the number of invocations, cpu
time used, average core usage, etc.

<DT><CODE>dump-acct</CODE>
<DD>
<DT><CODE>dump-utmp</CODE>
<DD>
display <CODE>acct</CODE> and <CODE>utmp</CODE> files in a human-readable format.

</DL>

<P>
For more detailed information on any of these programs, check the
chapter with the program title.

</P>


<H2><A NAME="SEC2" HREF="accounting.html#TOC2">A Note on File Names and Locations</A></H2>

<P>
The <CODE>wtmp</CODE> and <CODE>acct</CODE> files seem to live in different places
and have different names for every variant of u*x that exists.  The name
<CODE>wtmp</CODE> seems to be standard for the login accounting file, but the
process accounting file might be <CODE>acct</CODE> or <CODE>pacct</CODE> on your
system.  To find the actual locations and names of these files on your
system, specify the <CODE>--help</CODE> flag to any of the programs in this
package and the information will dumped to standard output.

</P>
<P>
Regardless of the names and locations of files on your system, this
manual will refer to the login accounting file as <CODE>wtmp</CODE> and the
process accounting files as <CODE>acct</CODE>, <CODE>savacct</CODE>, and
<CODE>usracct</CODE>.

</P>


<H2><A NAME="SEC3" HREF="accounting.html#TOC3">History of the Accounting Utilities</A></H2>

<P>
I don't have any idea who originally wrote these utilities.  If anybody
does, please send some mail to <CODE>noel@gnu.ai.mit.edu</CODE> and I'll add
your information here!

</P>
<P>
Since the first alpha versions of this software in late 1993, many
people have contributed to the package.  They are (in alphabetical
order):

</P>

<DL COMPACT>

<DT><CODE>Eric Backus &#60;ericb@lsid.hp.com&#62;</CODE>
<DD>
Suggested fixes for HP-UX 9.05 using /bin/cc: configure assumed you were
using <CODE>gcc</CODE> and tacked on <CODE>-Wall</CODE> etc.  He also noticed that
<CODE>file_rd.c</CODE> was doing pointer arithmetic on a <CODE>void *</CODE> pointer
(non-ANSI).

<DT><CODE>Christoph Badura &#60;bad@flatlin.ka.sub.org&#62;</CODE>
<DD>
Christoph was a BIG HELP in computing statistics, most notably k*sec
stuff!  He also did Xenix testing and contributed some Makefile fixes
and output optimizations.

<DT><CODE>Michael Calwas &#60;calwas@ttd.teradyne.com&#62;</CODE>
<DD>
Fixed bugs in mktime.c.

<DT><CODE>Alan Cox &#60;iiitac@pyr.swan.ac.uk&#62;</CODE>
<DD>
Original Linux kernel accounting patches.

<DT><CODE>Scott Crosby &#60;root@hypercube.res.cmu.edu&#62;</CODE>
<DD>
Suggested idea behind <CODE>--sort-real-time</CODE> for <CODE>sa</CODE>.

<DT><CODE>Solar Designer &#60;solar@false.com&#62;</CODE>
<DD>
Fixed off-by one error in allocations in <CODE>sa</CODE>.

<DT><CODE>Dirk Eddelbuettel &#60;edd@miles.econ.queensu.ca&#62;</CODE>
<DD>
Managed bug-fixes &#38; etc. for Debian distribution, as well as the
architect of merge of GNU + Debian distributions.  A big thanks to Dirk
for kicking me back into gear again after a long period of no work on
this project.

<DT><CODE>Jason Grant &#60;jamalcol@pc-5530.bc.rogers.wave.ca&#62;</CODE>
<DD>
Identified a buffer-overrun bug in <CODE>sa</CODE>.

<DT><CODE>Kaveh R. Ghazi &#60;ghazi@caip.rutgers.edu&#62;</CODE>
<DD>
Tested the package on many systems with compilers other than gcc.  Fixed
K&#38;R C support.

<DT><CODE>Susan Kleinmann &#60;sgk@sgk.tiac.net&#62;</CODE>
<DD>
Contributed excellent man pages!

<DT><CODE>Marek Michalkiewicz &#60;marekm@i17linuxb.ists.pwr.wroc.pl&#62;</CODE>
<DD>
Suggested the <CODE>--ip-address</CODE> flag for <CODE>last</CODE>.

<DT><CODE>David S. Miller &#60;davem@caip.rutgers.edu&#62;</CODE>
<DD>
Noticed missing GNU-standard makefile rules.

<DT><CODE>Walter Mueller &#60;walt@pi4.informatik.uni-mannheim.de&#62;</CODE>
<DD>
Noticed install target was missing, and corrected a typo for prefix in
Makefile.in.

<DT><CODE>Ian Murdock &#60;imurdock@gnu.ai.mit.edu&#62;</CODE>
<DD>
Tracked down miscellaneous bugs in sa.c under Linux.  Added Debian
package maintenance files.

<DT><CODE>Luc I. Suryo &#60;root@patriots.nl.mugnet.org&#62;</CODE>
<DD>
Suggested the <CODE>--user</CODE> flag for <CODE>lastcomm</CODE>.

<DT><CODE>Pedro A M Vazquez &#60;vazquez@iqm.unicamp.br&#62;</CODE>
<DD>
Fixed bugs in sa.c and tested under FreeBSD.

<DT><CODE>Marco van Wieringen &#60;Marco.van.Wieringen@mcs.nl.mugnet.org&#62;</CODE>
<DD>
Modified (wrote?) Linux kernel accounting patches.
</DL>



<H1><A NAME="SEC4" HREF="accounting.html#TOC4"><CODE>ac</CODE></A></H1>
<P>
<A NAME="IDX1"></A>
<A NAME="IDX2"></A>

</P>
<P>
The <CODE>ac</CODE> command prints out a report of connect time (in hours)
based on the logins/logouts in the current <CODE>wtmp</CODE> file.
A total is also printed out.

</P>
<P>
The accounting file <CODE>wtmp</CODE> is maintained by <CODE>init</CODE>
and <CODE>login</CODE>.  Neither of these programs creates the file; if the
file is not there, no accounting is done.  To begin accounting, create
the file with a length of zero.  <STRONG>NOTE:</STRONG> the
<CODE>wtmp</CODE> file can get really big, really fast.  You might
want to trim it every once and a while.

</P>
<P>
GNU <CODE>ac</CODE> works nearly the same u*x <CODE>ac</CODE>, though it's a little
smarter in its printing out of daily totals--it actually prints
<EM>every</EM> day, rather than skipping to the date of the next entry in
the <CODE>wtmp</CODE> file.

</P>


<H2><A NAME="SEC5" HREF="accounting.html#TOC5">Flags</A></H2>

<P>
All of the original <CODE>ac</CODE>'s options have been implemented, and a few have
been added.  Normally, when <CODE>ac</CODE> is invoked, the output looks like
this:

<PRE>
        total 93867.14
</PRE>

<P>
where total is the number of hours of connect time for every entry in
the <CODE>wtmp</CODE> file.  The rest of the flags modify the
output in one way or another.

</P>
<DL COMPACT>

<DT><CODE>-d</CODE>
<DD>
<DT><CODE>--daily-totals</CODE>
<DD>
Print totals for each day rather than just one big total at the end.
The output looks like this:

<PRE>
Jul  3  total     1.17
Jul  4  total     2.10
Jul  5  total     8.23
Jul  6  total     2.10
Jul  7  total     0.30
</PRE>

<DT><CODE>-p</CODE>
<DD>
<DT><CODE>--individual-totals</CODE>
<DD>
Print time totals for each user in addition to the usual
everything-lumped-into-one value.  It looks like:

<PRE>
        bob       8.06
        goff      0.60
        maley     7.37
        root      0.12
        total    16.15
</PRE>

<DT><CODE><VAR>people</VAR></CODE>
<DD>
Print out the sum total of the connect time used by all of the users
included in people.  Note that people is a space separated list of valid
user names; wildcards are not allowed.

<DT><CODE>-f <VAR>filename</VAR></CODE>
<DD>
<DT><CODE>--file <VAR>filename</VAR></CODE>
<DD>
Read from the file <VAR>filename</VAR> instead of the system's
<CODE>wtmp</CODE> file.

<DT><CODE>--complain</CODE>
<DD>
When the <CODE>wtmp</CODE> file has a problem (a time-warp, missing
record, or whatever), print out an appropriate error.

<DT><CODE>--reboots</CODE>
<DD>
Reboot records are <EM>not</EM> written at the time of a reboot, but when
the system restarts; therefore, it is impossible to know <VAR>exactly</VAR>
when the reboot occurred.  Users may have been logged into the system at
the time of the reboot, and many <CODE>ac</CODE>'s automatically count the
time between the login and the reboot record against the user (even
though all of that time <EM>shouldn't</EM> be, perhaps, if the system is
down for a long time, for instance).  If you want to count this time,
include the flag.  <STRONG>To make <CODE>ac</CODE> behave like the one that
was distributed with your OS, include this flag.</STRONG>

<DT><CODE>--supplants</CODE>
<DD>
Sometimes a logout record is not written for a specific terminal, so the
time that the last user accrued cannot be calculated.  If you want to
include the time from the user's login to the next login on the terminal
(though probably incorrect), include this flag.  <STRONG>To make
<CODE>ac</CODE> behave like the one that was distributed with your OS, include
this flag.</STRONG>

<DT><CODE>--timewarps</CODE>
<DD>
Sometimes, entries in a <CODE>wtmp</CODE> file will suddenly jump
back into the past without a clock change record occurring.  It is
impossible to know how long a user was logged in when this occurs.  If
you want to count the time between the login and the time warp against
the user, include this flag.  <STRONG>To make <CODE>ac</CODE> behave like the
one that was distributed with your OS, include this flag.</STRONG>

<DT><CODE>--compatibility</CODE>
<DD>
This is shorthand for typing out the three above options.

<DT><CODE>-a</CODE>
<DD>
<DT><CODE>--all-days</CODE>
<DD>
If we're printing daily totals, print a record for every day instead of
skipping intervening days where there is no login activity.  Without
this flag, time accrued during those intervening days gets listed under
the next day where there is login activity.

<DT><CODE>-y</CODE>
<DD>
<DT><CODE>--print-year</CODE>
<DD>
Print out the year when displaying dates.

<DT><CODE>--print-zeros</CODE>
<DD>
If a total for any category (save the grand total) is zero, print it.
The default is to suppress printing.

<DT><CODE>--debug</CODE>
<DD>
Print verbose internal information.

<DT><CODE>--tw-leniency <VAR>value</VAR></CODE>
<DD>
Set the time warp leniency value (in seconds).  Records in
<CODE>wtmp</CODE> files might be slightly out of order (most
notably when two logins occur within a one-second period -- the second
one gets written first).  By default, this value is set to 1 second.
Some <CODE>wtmp</CODE>'s are really screwed up (Suns) and require a
larger value here.  If the program notices this problem, time is not
assigned to users unless the <CODE>--timewarps</CODE> flag is used.  See the
Problems section for more information.

<DT><CODE>--tw-suspicious <VAR>value</VAR></CODE>
<DD>
Set the time warp suspicious value (in seconds).  If two records in the
<CODE>wtmp</CODE> file are farther than this number of seconds
apart, there is a problem with the wtmp file (or your machine
hasn't been used in a year).  If the program notices this problem, time
is not assigned to users unless the <CODE>--timewarps</CODE> flag is used.

<DT><CODE>-V</CODE>
<DD>
<DT><CODE>--version</CODE>
<DD>
Print <CODE>ac</CODE>'s version number.

<DT><CODE>-h</CODE>
<DD>
<DT><CODE>--help</CODE>
<DD>
Print <CODE>ac</CODE>'s usage string and default locations of system files to
standard output.
</DL>



<H2><A NAME="SEC6" HREF="accounting.html#TOC6">Problems</A></H2>

<P>
For no fault of <CODE>ac</CODE>'s, if two logins occur at the same time
(within a second of each other), each <CODE>login</CODE> process will try to
write an entry to the <CODE>wtmp</CODE> file.  With file system
overhead, it is forseeable that the entries would get written in the
wrong order.  GNU <CODE>ac</CODE> automatically compensates for this, but some
other <CODE>ac</CODE>s may not...  beware.

</P>


<H4><A NAME="SEC7" HREF="accounting.html#TOC7">The FTP Problem</A></H4>

<P>
I've tested the standard <CODE>ac</CODE> in Ultrix 4.2 (DECstation/DECsystem),
SunOS 4.1.1 (Sun3, Sun4, Sparc), Mach 2.5 (Omron/Luna), and DomainOS
10.3 (DN3500).  All of these <CODE>ac</CODE>s have trouble parsing entries in
which the line is <CODE>ftp</CODE><VAR>xxxx</VAR> (<VAR>xxxx</VAR> being some number).
Whenever these <CODE>ac</CODE>s see one of these entries, they log everyone
out at the time of the entry.

</P>
<P>
<STRONG>HOW IT HAPPENS:</STRONG> if there is a user logged into the machine when
an ftp connection occurs, (minimally) you'll get a login record for the
user, a login record for the ftp connection, and the logouts for both
afterwards (in either order).

</P>
<P>
<STRONG>TANGIBLE RESULT:</STRONG> the user who was logged in gets 'logged out'
at the time the ftp connection begins, and none of the time spent during
or after the ftp connection.  Therefore, when you run GNU <CODE>ac</CODE>,
the totals will most likely be greater than those of your system's
<CODE>ac</CODE> (provided you specify the other flags that will make GNU
<CODE>ac</CODE> behave like the system's).

</P>


<H4><A NAME="SEC8" HREF="accounting.html#TOC8">The Shutdown/Reboot Problem</A></H4>

<P>
On Suns, <CODE>init</CODE> is a little screwed up.  For some reason, after a
shutdown record is written, a reboot record is written with a time-stamp
<EM>before</EM> the shutdown (less than 30 seconds, usually).

</P>
<P>
<STRONG>TANGIBLE RESULT:</STRONG> GNU <CODE>ac</CODE> will notice the problem, log
everyone out (you can specify if you want the time to be added to the
user's total) and begin a new day entry based on the time of the
out-of-sync record.  If you try to print out daily totals, you'll notice
that some days might have two or more entries.

</P>
<P>
<STRONG>SOLUTION:</STRONG> To fix this, a timewarp leniency value has been
implemented.  If any record is out of order by this number of seconds
(defaults to 60) it gets ignored.  If you need to change this value (if
you think the totals are off because the value is too high), you can
change it using the <SAMP>`--timewarp-value'</SAMP> flag.  The rationale for the
60 second default is that of all of the machines with this problem, the
largest timewarp was 45.

</P>


<H4><A NAME="SEC9" HREF="accounting.html#TOC9">Stupid System V Machines</A></H4>

<P>
Some <CODE>ac</CODE>'s on System V machines (I've tried SGI Indigo &#38; SGI Indy)
forget to pay attention to the <CODE>ut_type</CODE> field in a <CODE>struct
utmp</CODE>.  As such, they chalk up a lot of time to non-existant processes
called <CODE>LOGIN</CODE> or <CODE>runlevel</CODE>.  

</P>
<P>
<STRONG>TANGIBLE RESULT:</STRONG> The amount of total time reported by the
system's <CODE>ac</CODE> is <STRONG>really</STRONG> off.  Often, it's several times
greater than what it should be.

</P>
<P>
<STRONG>SOLUTION:</STRONG> GNU <CODE>ac</CODE> always pays attention to the
<CODE>ut_type</CODE> record, so there's no possibility of chalking up time to
anything but user processes.

</P>


<H1><A NAME="SEC10" HREF="accounting.html#TOC10"><CODE>accton</CODE></A></H1>

<P>
<CODE>accton</CODE> turns process accounting on or off.  To save process
accounting information in <VAR>accountingfile</VAR>, use:

</P>
<P>
<CODE>accton <VAR>accountingfile</VAR></CODE>

</P>
<P>
If called with no arguments, it will, by default, stop process
accounting.

</P>


<H2><A NAME="SEC11" HREF="accounting.html#TOC11">Flags</A></H2>

<DL COMPACT>

<DT><CODE>-V</CODE>
<DD>
<DT><CODE>--version</CODE>
<DD>
Print <CODE>accton</CODE>'s version number.

<DT><CODE>-h</CODE>
<DD>
<DT><CODE>--help</CODE>
<DD>
Print <CODE>accton</CODE>'s usage string and default locations of system files
to standard output.

</DL>



<H1><A NAME="SEC12" HREF="accounting.html#TOC12"><CODE>last</CODE></A></H1>

<P>
<CODE>last</CODE> looks through the <CODE>wtmp</CODE> file (which records
all logins/logouts) and prints information about connect times of users.
Records are printed from most recent to least recent.  Records can be
specified by tty and username.  tty names can be abbreviated: <SAMP>`last
0'</SAMP> is equivalent to <SAMP>`last tty0'</SAMP>.

</P>
<P>
Multiple arguments can be specified: <SAMP>`last root console'</SAMP> will print
all of the entries for the user <CODE>root</CODE> and all entries logged in on
the <CODE>console</CODE> tty.

</P>
<P>
The special users <CODE>reboot</CODE> and <CODE>shutdown</CODE> log in when the
system reboots or (surprise) shuts down.  <SAMP>`last reboot'</SAMP> will
produce a record of reboot times.

</P>
<P>
If <CODE>last</CODE> is interrupted by a quit signal, it prints out how far
its search in the <CODE>wtmp</CODE> file had reached and then
quits:

<PRE>
weerapan  ttyq6    132.162.32.37    Mon Feb 15 19:07 - 19:21  (00:13)
weerapan  ttyq6    132.162.32.37    Mon Feb 15 19:07 - 19:21  (00:13)

interrupted at Mon Feb 15 19:07:52 1993
</PRE>



<H2><A NAME="SEC13" HREF="accounting.html#TOC13">Flags</A></H2>

<P>
This program implements the features of regular u*x <CODE>last</CODE> with a few
extra flags.  When <CODE>last</CODE> is invoked with no arguments, the output
looks like this:

<PRE>
gr151     ttyp2    ray.cs.oberlin.e Tue Feb 16 17:40   still logged in
jhoggard  ttyp2    csts.cs.oberlin. Tue Feb 16 17:39 - 17:39  (00:00)
jstarr    ttyp1    UNIX5.ANDREW.CMU Tue Feb 16 17:38   still logged in
jberman   ttypb    132.162.32.25    Tue Feb 16 17:34   still logged in
alee      ttyp7    csts.cs.oberlin. Tue Feb 16 17:34   still logged in
jbrick    ttyp2    ocvaxa.cc.oberli Tue Feb 16 17:33 - 17:36  (00:03)
mbastedo  ttypc    ocvaxa.cc.oberli Tue Feb 16 17:25 - 17:26  (00:01)
rgoodste  ttypb    ocvaxa.cc.oberli Tue Feb 16 17:22 - 17:26  (00:03)
huttar    ttyp9    lobby.ti.com     Tue Feb 16 17:19   still logged in
klutz     ttyp3    132.162.32.25    Tue Feb 16 17:14   still logged in
</PRE>

<DL COMPACT>

<DT><CODE>--no-truncate-ftp-entries</CODE>
<DD>
When printing out the information, don't chop the number part off of
<CODE>ftp</CODE><VAR>xxxx</VAR> entries.

<DT><CODE>-<VAR>number</VAR></CODE>
<DD>
<DT><CODE>-n <VAR>number</VAR></CODE>
<DD>
<DT><CODE>--lines <VAR>number</VAR></CODE>
<DD>
Limit the number of lines that <CODE>last</CODE> prints.

<DT><CODE>-f <VAR>filename</VAR></CODE>
<DD>
<DT><CODE>--file <VAR>filename</VAR></CODE>
<DD>
Read from the file <VAR>filename</VAR> instead of the system's
<CODE>wtmp</CODE> file.

<DT><CODE>-y</CODE>
<DD>
<DT><CODE>--print-year</CODE>
<DD>
Print out the year when displaying dates.

<DT><CODE>-s</CODE>
<DD>
<DT><CODE>--print-seconds</CODE>
<DD>
Print out seconds when displaying dates and durations.

<DT><CODE>--complain</CODE>
<DD>
When the <CODE>wtmp</CODE> file has a problem (a time-warp, missing
record, or whatever), print out an appropriate error.

<DT><CODE>-x</CODE>
<DD>
<DT><CODE>--more-records</CODE>
<DD>
Print out run level changes, shutdowns, and time changes in addition to
the normal records.

<DT><CODE>-a</CODE>
<DD>
<DT><CODE>--all-records</CODE>
<DD>
Print out all records in the <CODE>wtmp</CODE> file.

<DT><CODE>-i</CODE>
<DD>
<DT><CODE>--ip-address</CODE>
<DD>
Some machines store the IP address of a connection in a utmp record.
Enabling this option makes <CODE>last</CODE> print the IP address instead of
the hostname.

<DT><CODE>--tw-leniency <VAR>value</VAR></CODE>
<DD>
Set the time warp leniency value (in seconds).  See the <CODE>ac</CODE>
chapter for information.

<DT><CODE>--tw-suspicious <VAR>value</VAR></CODE>
<DD>
Set the time warp suspicious value (in seconds).  See the <CODE>ac</CODE>
chapter for information.

<DT><CODE>--debug</CODE>
<DD>
Print verbose internal information.

<DT><CODE>-V</CODE>
<DD>
<DT><CODE>--version</CODE>
<DD>
Print <CODE>last</CODE>'s version number.

<DT><CODE>-h</CODE>
<DD>
<DT><CODE>--help</CODE>
<DD>
Print <CODE>last</CODE>'s usage string and default locations of system files
to standard output.
</DL>



<H2><A NAME="SEC14" HREF="accounting.html#TOC14">Problems</A></H2>



<H4><A NAME="SEC15" HREF="accounting.html#TOC15">The Clock Change Problem</A></H4>

<P>
Of the <CODE>last</CODE>s I've tried, all of them have had problems parsing a
system clock change.  Instead of modifying the entries that have been
read, they just ignore the change and give you incorrect values.  GNU
<CODE>last</CODE> knows about clock changes and prints the correct times.

</P>
<P>
<STRONG>TANGIBLE RESULT:</STRONG> if you <CODE>diff</CODE> the output of your
<CODE>last</CODE> and GNU <CODE>last</CODE>, entries after (before, rather) a clock
change will be off by the amount of the clock change.

</P>


<H4><A NAME="SEC16" HREF="accounting.html#TOC16">The Ftp Problem</A></H4>

<P>
Most <CODE>last</CODE>s that I've examined have the same problem here as
<CODE>ac</CODE> does--they log everyone out as soon as they see an ftp entry.

</P>
<P>
<STRONG>TANGIBLE RESULT:</STRONG> GNU <CODE>last</CODE> will reflect the correct time
spent in an ftp session, so the totals that it gives will most likely be
greater than those given by the system <CODE>last</CODE>.

</P>


<H1><A NAME="SEC17" HREF="accounting.html#TOC17"><CODE>lastcomm</CODE></A></H1>

<P>
<CODE>lastcomm</CODE> prints out information about previously executed
commands.  If no arguments are specified, <CODE>lastcomm</CODE> will print
info about all of the commands in the <CODE>acct</CODE> file (the
record file).  If called with a command name, user name, or tty name,
only records containing those items will be displayed.  For example, to
find out which users used command <SAMP>`a.out'</SAMP> and which users were
logged into <SAMP>`tty0'</SAMP>, type:

</P>
<P>
<CODE>lastcomm a.out tty0</CODE>

</P>
<P>
This will print any entry for which <SAMP>`a.out'</SAMP> or <SAMP>`tty0'</SAMP> matches
in any of the record's fields (command, name, or tty).  If you want to
find only items that match ALL of the arguments on the command line, you
must use the '--strict-match' option.  For example, to list all of the
executions of command <SAMP>`a.out'</SAMP> by user <SAMP>`root'</SAMP> on terminal
<SAMP>`tty0'</SAMP>, type:

</P>
<P>
<CODE>lastcomm --strict-match a.out root tty0</CODE>

</P>
<P>
The order of the arguments is not important.

</P>
<P>
For each entry the following information is printed:

</P>

<UL>
<LI>

command name of the process
<LI>

flags, as recorded by the system accounting routines:

<UL>
<LI>

<STRONG>S</STRONG> command executed by super-user
<LI>

<STRONG>F</STRONG> command executed after a fork but without a following exec
<LI>

<STRONG>C</STRONG> command run in PDP-11 compatibility mode (VAX only)
<LI>

<STRONG>D</STRONG> command terminated with the generation of a core file
<LI>

<STRONG>X</STRONG> command was terminated with the signal SIGTERM
</UL>

<LI>

the name of the user who ran the process
<LI>

time the process exited
</UL>



<H2><A NAME="SEC18" HREF="accounting.html#TOC18">Flags</A></H2>

<P>
This program implements the features of regular u*x <CODE>lastcomm</CODE> with
a few extra flags.  When <CODE>lastcomm</CODE> is invoked without arguments,
the output looks like this:

<PRE>
nslookup         jberman  ttypb      0.03 secs Tue Feb 16 19:23
comsat           root     __         0.03 secs Tue Feb 16 19:19
uptime           ctilburg __         0.11 secs Tue Feb 16 19:23
sh          F    ctilburg __         0.02 secs Tue Feb 16 19:23
sleep            ctilburg __         0.02 secs Tue Feb 16 19:22
ls               noel     ttyp4      0.19 secs Tue Feb 16 19:23
</PRE>

<DL COMPACT>

<DT><CODE>--strict-match</CODE>
<DD>
Print only entries that match <EM>all</EM> of the arguments on the command
line.

<DT><CODE>--user <VAR>name</VAR></CODE>
<DD>
List records for user with <VAR>name</VAR>.  This is useful if you're trying
to match a username that happens to be the same as a command (e.g.,
<CODE>ed</CODE>).

<DT><CODE>--command <VAR>name</VAR></CODE>
<DD>
List records for command <VAR>name</VAR>.

<DT><CODE>--tty <VAR>name</VAR></CODE>
<DD>
List records for tty <VAR>name</VAR>.

<DT><CODE>-f <VAR>filename</VAR></CODE>
<DD>
<DT><CODE>--file <VAR>filename</VAR></CODE>
<DD>
Read from the file <VAR>filename</VAR> instead of the system's
<CODE>acct</CODE> file.

<DT><CODE>--debug</CODE>
<DD>
Print verbose internal information.

<DT><CODE>--version</CODE>
<DD>
Print <CODE>lastcomm</CODE>'s version number.

<DT><CODE>--help</CODE>
<DD>
Print <CODE>lastcomm</CODE>'s usage string and default locations of system
files to standard output.
</DL>



<H1><A NAME="SEC19" HREF="accounting.html#TOC19"><CODE>sa</CODE></A></H1>

<P>
<CODE>sa</CODE> summarizes information about previously executed commands as
recorded in the <CODE>acct</CODE> file.  In addition, it condenses this data
into the <CODE>savacct</CODE> summary file, which contains the
number of times the command was called and the system resources used.
The information can also be summarized on a per-user basis; <CODE>sa</CODE>
will save this information into <CODE>usracct</CODE>.  Usage:

</P>
<P>
<CODE>sa [<VAR>opts</VAR>] [<VAR>file</VAR>]</CODE>

</P>
<P>
If no arguments are specified, <CODE>sa</CODE> will print information about
all of the commands in the <CODE>acct</CODE> file.  If command
names have unprintable characters, or are only called once, <CODE>sa</CODE>
will sort them into a group called <CODE>***other</CODE>.

</P>
<P>
If called with a file name as the last argument, <CODE>sa</CODE> will use that
file instead of <CODE>acct</CODE>.

</P>
<P>
By default, <CODE>sa</CODE> will sort the output by sum of user and system
time.

</P>
<P>
The output fields are labeled as follows:

</P>
<DL COMPACT>

<DT><CODE>cpu</CODE>
<DD>
sum of system and user time in cpu seconds

<DT><CODE>re</CODE>
<DD>
"real time" in cpu seconds

<DT><CODE>k</CODE>
<DD>
cpu-time averaged core usage, in 1k units

<DT><CODE>avio</CODE>
<DD>
average number of I/O operations per execution

<DT><CODE>tio</CODE>
<DD>
total number of I/O operations

<DT><CODE>k*sec</CODE>
<DD>
cpu storage integral (kilo-core seconds)

<DT><CODE>u</CODE>
<DD>
user cpu time in cpu seconds

<DT><CODE>s</CODE>
<DD>
system time in cpu seconds

</DL>

<P>
An asterisk will appear after the name of commands that forked but
didn't call <CODE>exec</CODE>.

</P>


<H2><A NAME="SEC20" HREF="accounting.html#TOC20">Flags</A></H2>

<DL COMPACT>

<DT><CODE>-a</CODE>
<DD>
<DT><CODE>--list-all-names</CODE>
<DD>
Force <CODE>sa</CODE> not to sort those command names with unprintable
characters and those used only once into the `<CODE>***other</CODE>' group.

<DT><CODE>-b</CODE>
<DD>
<DT><CODE>--sort-sys-user-div-calls</CODE>
<DD>
Sort the output by the sum of user and system time divided by the number
of calls.

<DT><CODE>-c</CODE>
<DD>
<DT><CODE>--percentages</CODE>
<DD>
Print percentages of total time for the command's user, system, and real
time values.

<DT><CODE>-d</CODE>
<DD>
<DT><CODE>--sort-avio</CODE>
<DD>
Sort the output by the average number of disk I/O operations.

<DT><CODE>-D</CODE>
<DD>
<DT><CODE>--sort-tio</CODE>
<DD>
Print and sort the output by the total number of disk I/O operations.

<DT><CODE>-f</CODE>
<DD>
<DT><CODE>--not-interactive</CODE>
<DD>
When using the <CODE>--threshold</CODE> option, assume that all answers to
interactive queries will be affirmative.

<DT><CODE>-i</CODE>
<DD>
<DT><CODE>--dont-read-summary-file</CODE>
<DD>
Don't read the information in <CODE>savacct</CODE>.

<DT><CODE>-j</CODE>
<DD>
<DT><CODE>--print-seconds</CODE>
<DD>
Instead of printing total minutes for each category, print seconds per
call.

<DT><CODE>-k</CODE>
<DD>
<DT><CODE>--sort-cpu-avmem</CODE>
<DD>
Sort the output by cpu time average memory usage.

<DT><CODE>-K</CODE>
<DD>
<DT><CODE>--sort-ksec</CODE>
<DD>
Print and sort the output by the cpu-storage integral.

<DT><CODE>-l</CODE>
<DD>
<DT><CODE>--separate-times</CODE>
<DD>
Print separate columns for system and user time; usually the two are
added together and listed as <CODE>cpu</CODE>.

<DT><CODE>-m</CODE>
<DD>
<DT><CODE>--user-summary</CODE>
<DD>
Print the number of processes and number of CPU minutes on a per-user
basis.

<DT><CODE>-n</CODE>
<DD>
<DT><CODE>--sort-num-calls</CODE>
<DD>
Sort the output by the number of calls.  This is the default sorting
method.

<DT><CODE>-r</CODE>
<DD>
<DT><CODE>--reverse-sort</CODE>
<DD>
Sort output items in reverse order.

<DT><CODE>-s</CODE>
<DD>
<DT><CODE>--merge</CODE>
<DD>
Merge the summarized accounting data into the summary files
<CODE>savacct</CODE> and <CODE>usracct</CODE>.

<DT><CODE>-t</CODE>
<DD>
<DT><CODE>--print-ratio</CODE>
<DD>
For each entry, print the ratio of real time to the sum of system and
user times.  If the sum of system and user times is too small to
report--the sum is zero---<CODE>*ignore*</CODE> will appear in this field.

<DT><CODE>-u</CODE>
<DD>
<DT><CODE>--print-users</CODE>
<DD>
For each command in the accounting file, print the userid and command
name.  After printing all entries, quit.  <STRONG>Note</STRONG>: this flag
supersedes all others.

<DT><CODE>-v <VAR>num</VAR></CODE>
<DD>
<DT><CODE>--threshold <VAR>num</VAR></CODE>
<DD>
Print commands which were executed <VAR>num</VAR> times or fewer and await a
reply from the terminal.  If the response begins with <CODE>y</CODE>, add the
command to the <CODE>**junk**</CODE> group.

<DT><CODE>--separate-forks</CODE>
<DD>
It really doesn't make any sense to me that the stock version of
<CODE>sa</CODE> separates statistics for a particular executable depending on
whether or not that command forked.  Therefore, GNU <CODE>sa</CODE> lumps this
information together unless this option is specified.

<DT><CODE>--sort-real-time</CODE>
<DD>
Sort the output by the "real time" (elapsed time) for each command.

<DT><CODE>--debug</CODE>
<DD>
Print verbose internal information.

<DT><CODE>-V</CODE>
<DD>
<DT><CODE>--version</CODE>
<DD>
Print <CODE>sa</CODE>'s version number.

<DT><CODE>-h</CODE>
<DD>
<DT><CODE>--help</CODE>
<DD>
Print <CODE>sa</CODE>'s usage string and default locations of system files to
standard output.
</DL>

<P>
<STRONG>Note</STRONG>: if more than one sorting option is specified, the list
will be sorted by the one specified last on the command line.

</P>


<H2><A NAME="SEC21" HREF="accounting.html#TOC21">Problems</A></H2>

<P>
I haven't been able to test this on many different machines because the
data files grow so big in a short time; our sysadmin would rather save
the disk space.

</P>
<P>
Most versions of <CODE>sa</CODE> that I've tested don't pay attention to flags
like <CODE>--print-seconds</CODE> and <CODE>--sort-num-calls</CODE> when printing
out commands when combined with the <CODE>--user-summary</CODE> or
<CODE>--print-users</CODE> flags.  GNU <CODE>sa</CODE> pays attention to these flags
if they are applicable.

</P>


<H3><A NAME="SEC22" HREF="accounting.html#TOC22">mips sa</A></H3>

<P>
The average memory use is stored as a short rather than a double, so we
suffer from round-off errors.  GNU <CODE>sa</CODE> uses double the whole way
through.

</P>

<P><HR><P>
This document was generated on 7 November 1998 using the
<A HREF="http://wwwinfo.cern.ch/dis/texi2html/">texi2html</A>
translator version 1.52.</P>
</BODY>
</HTML>
